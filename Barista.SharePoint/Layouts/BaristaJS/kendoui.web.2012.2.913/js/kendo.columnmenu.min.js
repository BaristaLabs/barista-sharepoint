/*
* Kendo UI Web v2012.2.913 (http://kendoui.com)
* Copyright 2012 Telerik AD. All rights reserved.
*
* Kendo UI Web commercial licenses may be obtained at
* https://www.kendoui.com/purchase/license-agreement/kendo-ui-web-commercial.aspx
* If you do not own a commercial license, this file shall be governed by the
* GNU General Public License (GPL) version 3.
* For GPL requirements, please review: http://www.gnu.org/copyleft/gpl.html
*/
;(function(a,b){function t(b){return a.trim(b).replace(/&nbsp;/gi,"")}var c=window.kendo,d=c.ui,e=a.proxy,f=a.extend,g=a.grep,h=a.map,i=a.inArray,j="k-state-selected",k="asc",l="desc",m="change",n="kendoPopup",o="kendoFilterMenu",p="kendoMenu",q=".kendoColumnMenu",r=/(\[|\]|\$|\.|\:|\+)/g,s=d.Widget,u=s.extend({init:function(b,d){var f=this,g;s.fn.init.call(f,b,d),b=f.element,d=f.options,f.owner=d.owner,f.dataSource=d.dataSource,f.field=b.attr(c.attr("field")),g=b.find(".k-header-column-menu"),g[0]||(g=b.prepend('<a class="k-header-column-menu" href="#"><span class="k-icon k-i-arrowhead-s"/></a>').find(".k-header-column-menu")),f.link=g.on("click"+q,e(f._click,f)),f.wrapper=a('<div class="k-column-menu"/>'),f.wrapper.html(c.template(v)({ns:c.ns,messages:d.messages,sortable:d.sortable,filterable:d.filterable,columns:f._ownerColumns(),showColumns:d.columns})),f.popup=f.wrapper[n]({anchor:g,open:e(f._open,f)}).data(n),f._menu(),f._sort(),f._columns(),f._filter()},options:{name:"ColumnMenu",messages:{sortAscending:"Sort Ascending",sortDescending:"Sort Descending",filter:"Filter",columns:"Columns"},columns:!0,sortable:!0,filterable:!0},destroy:function(){var a=this;s.fn.destroy.call(a),a.filterMenu&&a.filterMenu.destroy(),a.dataSource.unbind("refresh",a._refreshHandler),a.options.columns&&(a.owner.unbind("columnShow",a._updateColumnsMenuHandler),a.owner.unbind("columnHide",a._updateColumnsMenuHandler)),a.menu.element.off(q),a.menu.destroy(),a.wrapper.off(q),a.popup.destroy(),a.link.off(q)},close:function(){this.menu.close(),this.popup.close()},_click:function(a){a.preventDefault(),a.stopPropagation(),this.popup.toggle()},_open:function(){a(".k-column-menu").not(this.wrapper).each(function(){a(this).data(n).close()})},_ownerColumns:function(){var a=this.owner.columns,b=g(a,function(a){var b=!0,c=t(a.title||"");if(a.menu===!1||!a.field&&!c.length)b=!1;return b});return h(b,function(b){return{field:b.field||b.title,title:b.title||b.field,hidden:b.hidden,index:i(b,a)}})},_menu:function(){this.menu=this.wrapper.children()[p]({orientation:"vertical",closeOnClick:!1}).data(p)},_sort:function(){var b=this;b.options.sortable&&(b.refresh(),b._refreshHandler=e(b.refresh,b),b.dataSource.bind(m,b._refreshHandler),b.menu.element.on("click"+q,".k-sort-asc, .k-sort-desc",function(){var c=a(this),d=c.hasClass("k-sort-asc")?k:l;c.parent().find(".k-sort-"+(d==k?l:k)).removeClass(j),b._sortDataSource(c,d),b.close()}))},_sortDataSource:function(a,c){var d=this,e=d.options.sortable,f=d.dataSource,g,h,i=f.sort()||[];a.hasClass(j)&&e&&e.allowUnsort!==!1?(a.removeClass(j),c=b):a.addClass(j);if(e===!0||e.mode==="single")i=[{field:d.field,dir:c}];else{for(g=0,h=i.length;g<h;g++)if(i[g].field===d.field){i.splice(g,1);break}i.push({field:d.field,dir:c})}f.sort(i)},_columns:function(){var b=this;b.options.columns&&(b._updateColumnsMenu(),b._updateColumnsMenuHandler=e(b._updateColumnsMenu,b),b.owner.bind(["columnHide","columnShow"],b._updateColumnsMenuHandler),b.wrapper.on(m+q,"[type=checkbox]",function(d){var e=a(this),f,h,j=b.owner.columns,k=e.attr(c.attr("field"));h=g(j,function(a){return a.field==k||a.title==k})[0],f=i(h,j),e.is(":checked")?b.owner.showColumn(f):b.owner.hideColumn(f)}))},_updateColumnsMenu:function(){var a="["+c.attr("field")+"=",b=this._ownerColumns(),d=h(b,function(b){return a+b.field.replace(r,"\\$1")+"]"}).join(","),e=g(b,function(a){return!a.hidden}),f=h(e,function(b){return a+b.field.replace(r,"\\$1")+"]"}).join(",");this.wrapper.find(d).attr("checked",!1),this.wrapper.find(f).attr("checked",!0).attr("disabled",e.length==1)},_filter:function(){var a=this,b=a.options;b.filterable!==!1&&(a.filterMenu=a.wrapper.find(".k-filterable")[o](f(!0,{},{appendToElement:!0,dataSource:b.dataSource,values:b.values,field:a.field},b.filterable)).data(o))},refresh:function(){var a=this,b=a.options.dataSource.sort()||[],c,d=a.field,e,f;a.wrapper.find(".k-sort-asc, .k-sort-desc").removeClass(j);for(e=0,f=b.length;e<f;e++)c=b[e],d==c.field&&a.wrapper.find(".k-sort-"+c.dir).addClass(j)}}),v='<ul>#if(sortable){#<li class="k-item k-sort-asc"><span class="k-link"><span class="k-sprite k-i-sort-asc"></span>${messages.sortAscending}</span></li><li class="k-item k-sort-desc"><span class="k-link"><span class="k-sprite k-i-sort-desc"></span>${messages.sortDescending}</span></li>#if(showColumns || filterable){#<li class="k-separator"></li>#}##}##if(showColumns){#<li class="k-item k-columns-item"><span class="k-link"><span class="k-sprite k-i-columns"></span>${messages.columns}</span><ul>#for (var col in columns) {#<li><label><input type="checkbox" data-#=ns#field="#=columns[col].field#" data-#=ns#index="#=columns[col].index#"/>#=columns[col].title#</label></li>#}#</ul></li>#if(filterable){#<li class="k-separator"></li>#}##}##if(filterable){#<li class="k-item k-filter-item"><span class="k-link"><span class="k-sprite k-filter"></span>${messages.filter}</span><ul><li><div class="k-filterable"></div></li></ul></li>#}#</ul>';d.plugin(u)})(jQuery);